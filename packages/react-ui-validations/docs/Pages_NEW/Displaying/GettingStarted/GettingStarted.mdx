import { Meta, Canvas } from '@storybook/blocks';
import * as DocsStories from './GettingStarted.docs.stories.tsx';

<Meta of={DocsStories} />

# Начало работы

[![Version](https://img.shields.io/npm/v/@skbkontur/react-ui-validations?style=flat-square)](https://www.npmjs.com/package/@skbkontur/react-ui-validations)

Исходный код [на GitHub](https://github.com/skbkontur/retail-ui/tree/master/packages/react-ui-validations).

Библиотека реализует поведение валидаций форм и отображение найденных ошибок описанное в [Контур.Гайдах](https://guides.kontur.ru/principles/validation/).

Библиотека совместима с контролами из библиотеки [React UI](https://tech.skbkontur.ru/react-ui/).

## Установка

`npm install --save @skbkontur/react-ui-validations`

## Использование

Для отображения валидаций используется два компонента `ValidationWrapper` и `ValidationContainer`.
Компонент `ValidationWrapper` оборачивает контрол, для которого должна отобразиться валидация.
Компонент `ValidationContainer` оборачивает всю валидируемую форму, внутри которой используются компоненты `ValidationWrapper`.

```jsx static
    <ValidationContainer>
      //...
      <ValidationWrapper validationInfo={...}>
        <Input/>
      </ValidationWrapper>
      //...
    </ValidationContainer>
```

Значение валидации задается через проп `validationInfo` компонента `ValidationWrapper`.
Для обратной совместимости компонент `ValidationWrapper` дополнительно экспортируется как `ValidationWrapperV1`.

Невалидное состояние задается объектом валидации `validationInfo={{message: "..."}}`.
Поле `message` имеет тип ReactNode, то есть в него можно передать строку, React-компонент и т.п.

```jsx static
<ValidationWrapper validationInfo={{ message: <b>Ошибка</b> }}>
  <Input />
</ValidationWrapper>
```

Валидное состояние задается значением `validationInfo={null}`.

```jsx static
<ValidationWrapper validationInfo={null}>
  <Input />
</ValidationWrapper>
```

### Пример

<Canvas of={DocsStories.StaticValidation} />

```jsx static
import React from 'react';
import { Input } from '@skbkontur/react-ui/components/Input';

import { ValidationContainer, ValidationWrapper } from '../../../../src';
import { Form } from '../../../Common/Form';

export default class StaticValidationDemo extends React.Component {
  public render() {
    return (
      <ValidationContainer>
        <Form>
          <Form.Line title="Поле с ошибкой">
            <ValidationWrapper validationInfo={{ message: <b>Ошибка</b> }}>
              <Input value={'bad'} />
            </ValidationWrapper>
          </Form.Line>
          <Form.Line title="Поле без ошибки">
            <ValidationWrapper validationInfo={null}>
              <Input value={'ok'} />
            </ValidationWrapper>
          </Form.Line>
        </Form>
      </ValidationContainer>
    );
  }
}
```

Обычно валидация вычисляется динамически по текущему значению контрола.
Для корректоного отображения нужно передавать всегда актуальное состояние валидации.
Компонент `ValidationWrapper` сам в соответствии с Контур.Гайдами принимает решение, когда подсветить котрол и отобразить сообщение об ошибке.

```jsx static
const value = this.state.value;
const validationInfo = !isValid(value) ? { message: 'Error' } : null;

<ValidationWrapper validationInfo={validationInfo}>
  <Input value={value} />
</ValidationWrapper>;
```

### Пример

<Canvas of={DocsStories.ConditionalValidation} />

```jsx static
import React from 'react';
import { Input } from '@skbkontur/react-ui/components/Input';

import { ValidationContainer, ValidationWrapper } from '../../../../src';
import { Form } from '../../../Common/Form';

interface ConditionalValidationDemoState {
  value: string;
}
export default class ConditionalValidationDemo extends React.Component {
  public state: ConditionalValidationDemoState = {
    value: '',
  };

  public render() {
    const { value } = this.state;

    const validationInfo = !/^\d*$/.test(value) ? { message: 'Только цифры' } : null;

    return (
      <ValidationContainer>
        <Form>
          <Form.Line title="Номер">
            <ValidationWrapper validationInfo={validationInfo}>
              <Input
                placeholder={'Только цифры'}
                value={value}
                onValueChange={(v) => this.setState({ value: v })}
              />
            </ValidationWrapper>
          </Form.Line>
        </Form>
      </ValidationContainer>
    );
  }
}
```
